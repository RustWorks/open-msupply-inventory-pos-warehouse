query namesAndItems {
  suppliers: names(filter: { isSupplier: true }, page: { first: 5 }) {
    ... on NameConnector {
      nodes {
        id
        code
        name
      }
    }
  }
  customers: names(filter: { isCustomer: true }, page: { first: 5 }) {
    ... on NameConnector {
      nodes {
        id
        code
        name
      }
    }
  }
  items(page: { first: 5 }) {
    ... on ItemConnector {
      nodes {
        id
        name
        code
        availableBatches {
          ... on StockLineConnector {
            nodes {
              availableNumberOfPacks
              batch
              packSize
              id
              totalNumberOfPacks
            }
          }
        }
      }
    }
  }
}

mutation addStock(
  $otherPartyId: String!
  $invoiceId: String!
  $costPricePerPack: Float!
  $lineId: String!
  $itemId: String!
  $numberOfPacks: Int!
  $packSize: Int!
  $sellPricePerPack: Float!
) {
  insertSupplierInvoice(
    input: { id: $invoiceId, otherPartyId: $otherPartyId, status: DRAFT }
  ) {
    ... on InsertSupplierInvoiceError {
      error {
        __typename
      }
    }
  }
  insertSupplierInvoiceLine(
    input: {
      id: $lineId
      invoiceId: $invoiceId
      itemId: $itemId
      packSize: $packSize
      costPricePerPack: $costPricePerPack
      sellPricePerPack: $sellPricePerPack
      numberOfPacks: $numberOfPacks
    }
  ) {
    ... on InsertSupplierInvoiceLineError {
      error {
        __typename
      }
    }
  }
  updateSupplierInvoice(input: { id: $invoiceId, status: FINALISED }) {
    ... on UpdateSupplierInvoiceError {
      error {
        __typename
      }
    }
    ... on InvoiceNode {
      id
      otherPartyName
      otherPartyId
      invoiceNumber
      lines {
        ... on InvoiceLineConnector {
          nodes {
            itemCode
            itemId
            itemName
            id
            stockLine {
              ... on StockLineNode {
                id
                availableNumberOfPacks
                packSize
                itemId
                expiryDate
                costPricePerPack
                batch
                sellPricePerPack
                storeId
                totalNumberOfPacks
              }
            }
            numberOfPacks
            packSize
            sellPricePerPack
            expiryDate
            costPricePerPack
            batch
          }
        }
      }
      pricing {
        ... on InvoicePricingNode {
          __typename
          totalAfterTax
        }
      }
    }
  }
}

mutation issueStock(
  $invoiceId: String!
  $otherPartyId: String!
  $lineId: String!
  $stockLineId: String!
  $itemId: String!
  $numberOfPacks: Int!
) {
  insertCustomerInvoice(
    input: { id: $invoiceId, otherPartyId: $otherPartyId }
  ) {
    ... on InsertCustomerInvoiceError {
      error {
        __typename
      }
    }
  }
  insertCustomerInvoiceLine(
    input: {
      id: $lineId
      invoiceId: $invoiceId
      itemId: $itemId
      stockLineId: $stockLineId
      numberOfPacks: $numberOfPacks
    }
  ) {
    ... on InsertCustomerInvoiceLineError {
      error {
        __typename
      }
    }
  }
  updateCustomerInvoice(input: { id: $invoiceId, status: CONFIRMED }) {
    ... on InvoiceNode {
      id
      confirmedDatetime
      entryDatetime
      lines {
        ... on InvoiceLineConnector {
          nodes {
            id
            itemCode
            itemId
            itemName
            numberOfPacks
            stockLine {
              ... on StockLineNode {
                id
                availableNumberOfPacks
                batch
                costPricePerPack
                expiryDate
                itemId
                packSize
                sellPricePerPack
                storeId
                totalNumberOfPacks
              }
            }
            sellPricePerPack
            packSize
            expiryDate
            costPricePerPack
            batch
          }
        }
      }
      pricing {
        ... on InvoicePricingNode {
          __typename
          totalAfterTax
        }
      }
    }
  }
}
