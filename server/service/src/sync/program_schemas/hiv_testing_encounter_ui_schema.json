{
  "type": "Categorization",
  "elements": [
    {
      "type": "Category",
      "label": "HTC Register",
      "options": { "icon": "document" },
      "elements": [
        {
          "type": "Control",
          "scope": "#/properties/htcRegisterSerialNumber",
          "label": "HTC Register Serial No.",
          "options": { "width": "100px" }
        }
      ]
    },
    {
      "type": "Category",
      "label": "Pregnancy",
      "options": { "icon": "condom" },
      "elements": [
        {
          "type": "Control",
          "label": "Pregnant:",
          "scope": "#/properties/familyPlanning/properties/pregnant"
        },
        {
          "type": "Control",
          "label": "Contraception:",
          "scope": "#/properties/familyPlanning/properties/contraception"
        }
      ]
    },
    {
      "type": "Category",
      "label": "Risk Behaviour",
      "options": { "icon": "document" },
      "elements": [
        {
          "type": "Label",
          "text": "Have you experienced any of the following in the past 12 months?",
          "variant": "h2"
        },
        {
          "type": "Control",
          "label": "Previous HIV Test Result:",
          "scope": "#/properties/riskBehaviour/properties/previousHIVTestResult",
          "options": {
            "show": [
              ["POSITIVE", "Positive"],
              ["NEGATIVE", "Negative"],
              ["UNKNOWN", "Unknown"],
              ["NOT_DONE", "Not done"]
            ]
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/previousHIVTestDate",
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/riskBehaviour/properties/previousHIVTestResult",
              "schema": { "enum": ["POSITIVE", "NEGATIVE", "UNKNOWN"] }
            }
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/receivedBloodTransfusion"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/injectedDrugsWithoutDoctorAdvice"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/accidentalNeedlePick"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/sexualTransmittedInfection"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/unprotectedVaginalSex"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/unprotectedAnalSex"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/prostitution",
          "label": "Sex in exchange for money/goods/services"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/sexWithSameSex"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/forcedSexWithoutConsent"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/numberMaleSexualPartners6Month"
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/numberFemaleSexualPartners6Month"
        },
        {
          "type": "DecisionTree",
          "scope": "#/properties/riskBehaviour/properties/riskGroup",
          "options": {
            "basePath": "riskBehaviour",
            "tree": {
              "root": "root",
              "nodes": {
                "root": {
                  "branches": [
                    {
                      "patientField": "gender",
                      "equalTo": "MALE",
                      "node": "isMale"
                    },
                    {
                      "patientField": "gender",
                      "equalTo": "FEMALE",
                      "node": "isFemale"
                    },
                    {
                      "patientField": "gender",
                      "equalTo": "TRANSGENDER",
                      "node": "isTransgender"
                    }
                  ]
                },
                "isMale": {
                  "value": "LRM",
                  "branches": [
                    {
                      "dataField": "sexWithSameSex",
                      "equalTo": true,
                      "node": "maleSexWithSameSex"
                    },
                    {
                      "dataField": "unprotectedAnalSex",
                      "equalTo": true,
                      "node": "maleSexWithSameSex"
                    },
                    {
                      "dataField": "numberMaleSexualPartners6Month",
                      "greaterThan": 0,
                      "node": "maleSexWithSameSex"
                    },
                    {
                      "dataField": "forcedSexWithoutConsent",
                      "equalTo": true,
                      "node": "maleHadSexWithFemale"
                    },
                    {
                      "dataField": "numberFemaleSexualPartners6Month",
                      "greaterThan": 0,
                      "node": "maleHadSexWithFemale"
                    }
                  ]
                },
                "maleSexWithSameSex": {
                  "value": "MSM",
                  "branches": [
                    {
                      "dataField": "prostitution",
                      "equalTo": true,
                      "value": "MSMSW"
                    }
                  ]
                },
                "maleHadSexWithFemale": {
                  "value": "LRM",
                  "branches": [
                    {
                      "dataField": "numberFemaleSexualPartners6Month",
                      "greaterThan": 1,
                      "node": "maleHadSexWithMultiFemale"
                    }
                  ]
                },
                "maleHadSexWithMultiFemale": {
                  "value": "HRM",
                  "branches": [
                    {
                      "dataField": "prostitution",
                      "equalTo": true,
                      "value": "MSW"
                    }
                  ]
                },
                "isFemale": {
                  "value": "LRW",
                  "branches": [
                    {
                      "dataField": "unprotectedVaginalSex",
                      "equalTo": true,
                      "node": "femaleHadSex"
                    },
                    {
                      "dataField": "unprotectedAnalSex",
                      "equalTo": true,
                      "node": "femaleHadSex"
                    },
                    {
                      "dataField": "sexWithSameSex",
                      "equalTo": true,
                      "node": "femaleHadSex"
                    },
                    {
                      "dataField": "forcedSexWithoutConsent",
                      "equalTo": true,
                      "node": "femaleHadSex"
                    },
                    {
                      "dataField": "numberMaleSexualPartners6Month",
                      "greaterThan": 0,
                      "node": "femaleHadSex"
                    },
                    {
                      "dataField": "numberFemaleSexualPartners6Month",
                      "greaterThan": 0,
                      "node": "femaleHadSex"
                    }
                  ]
                },
                "femaleHadSex": {
                  "value": "LRW",
                  "branches": [
                    {
                      "dataField": "numberMaleSexualPartners6Month",
                      "greaterThan": 1,
                      "node": "femaleHadSexMulti"
                    },
                    {
                      "dataField": "numberFemaleSexualPartners6Month",
                      "greaterThan": 1,
                      "node": "femaleHadSexMulti"
                    }
                  ]
                },
                "femaleHadSexMulti": {
                  "value": "HRW",
                  "branches": [
                    {
                      "dataField": "prostitution",
                      "equalTo": true,
                      "value": "FSW"
                    }
                  ]
                },
                "isTransgender": {
                  "value": "TG",
                  "branches": [
                    {
                      "dataField": "prostitution",
                      "equalTo": true,
                      "value": "TGSW"
                    }
                  ]
                }
              }
            }
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/screeningOutcomeGBV",
          "label": "GBV Screening Outcome:",
          "options": {
            "show": [
              ["POSITIVE", "Positive"],
              ["NEGATIVE", "Negative"],
              ["NOT_DONE", "Not done"],
              ["DECLINED", "Declined"]
            ]
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/riskBehaviour/properties/referredToGBVService",
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/riskBehaviour/properties/screeningOutcomeGBV",
              "schema": { "enum": ["POSITIVE"] }
            }
          }
        }
      ]
    },
    {
      "type": "Category",
      "label": "Informed Consent",
      "options": { "icon": "document" },
      "elements": [
        {
          "type": "Control",
          "scope": "#/properties/informedConsent/properties/preTestCounsellingDone",
          "label": "Was pre-test counselling done?"
        },
        {
          "type": "Control",
          "scope": "#/properties/informedConsent/properties/consentFormSigned",
          "label": "Was the consent form signed?"
        }
      ]
    },
    {
      "type": "Category",
      "label": "HIV Testing",
      "options": { "icon": "stethoscope" },
      "elements": [
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/datetime"
        },
        {
          "type": "Control",
          "label": "Type:",
          "scope": "#/properties/hivTesting/properties/type"
        },
        {
          "type": "Control",
          "label": "Result:",
          "scope": "#/properties/hivTesting/properties/result",
          "options": {
            "show": [
              ["POSITIVE", "Positive"],
              ["NEGATIVE", "Negative"],
              ["INCONCLUSIVE", "Inconclusive"]
            ]
          }
        },
        { "type": "Spacer", "options": { "margin": 10 } },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/postTestCounsellingDone",
          "label": "Post-test counselling done?"
        },
        { "type": "Spacer" },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/referredForARTServices",
          "label": "Did you refer the patient for ART services?"
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/referredARTFacility",
          "label": "Where?",
          "options": {
            "show": [
              ["THIS_FACILITY", "This facility"],
              ["OTHER_FACILITY", "Other facility"]
            ]
          },
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/hivTesting/properties/referredForARTServices",
              "schema": {
                "const": true
              }
            }
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/referredARTFacilityName",
          "label": "If another facility, name of the facility",
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/hivTesting/properties/referredARTFacility",
              "schema": { "enum": ["OTHER_FACILITY"] }
            }
          }
        },
        { "type": "Spacer" },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/clientEscorted",
          "label": "Was the client escorted?"
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/serodiscordantCoupleCounsellingProvided",
          "label": "If serodiscordant, was couple counselling provided?"
        },
        { "type": "Spacer" },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/screenedAndReferredForOtherServices",
          "label": "Was client screened and referred for other services?"
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/otherServices",
          "label": "If yes, which one(s)?",
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/hivTesting/properties/screenedAndReferredForOtherServices",
              "schema": {
                "const": true
              }
            }
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/otherServiceName",
          "label": "If other, specify",
          "rule": {
            "condition": {
              "schema": {
                "properties": {
                  "screenedAndReferredForOtherServices": { "const": true },
                  "otherServices": {
                    "contains": {
                      "const": "OTHER"
                    }
                  }
                },
                "required": ["otherServices"]
              },
              "scope": "#/properties/hivTesting"
            },
            "effect": "ENABLE"
          }
        },
        { "type": "Spacer" },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/condomsLubricantsOffered",
          "label": "Where condoms and/or lubricants offered to the client?"
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/numberOfMaleCondoms",
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/hivTesting/properties/condomsLubricantsOffered",
              "schema": {
                "const": true
              }
            }
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/numberOfFemaleCondoms",
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/hivTesting/properties/condomsLubricantsOffered",
              "schema": {
                "const": true
              }
            }
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/numberOfLubricants",
          "rule": {
            "effect": "ENABLE",
            "condition": {
              "scope": "#/properties/hivTesting/properties/condomsLubricantsOffered",
              "schema": {
                "const": true
              }
            }
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/hivTesting/properties/condomDemonstration",
          "label": "Did you conduct condom demonstration?"
        }
      ]
    }
  ],
  "options": {
    "variant": "tab"
  }
}
