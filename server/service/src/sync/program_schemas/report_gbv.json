{
  "index": {
    "template": "template.html",
    "header": null,
    "footer": null,
    "query": "query.graphql"
  },
  "entries": {
    "query.graphql": {
      "type": "GraphGLQuery",
      "data": {
        "query": "query GBVSummary($storeId: String, $now: String) {\n  store(id: $storeId) {\n    ... on StoreNode {\n      storeName\n      logo\n    }\n  }\n\n  patients(storeId: $storeId) {\n    ... on PatientConnector {\n      nodes {\n        gender\n        dateOfBirth\n        programEnrolments(filter: { program: { equalTo: \"HIV Care & Treatment\" } }) {\n          programEnrolmentId\n          encounters(\n            page: { first: 1, offset: 0 }\n            sort: { key: startDatetime, desc: true }\n            filter: {\n              program: { equalTo: \"HIV Care & Treatment\" }\n              startDatetime: { beforeOrEqualTo: $now }\n              documentData: { like: \"\\\"genderBasedViolence\\\":\" }\n            }\n          ) {\n            nodes {\n              startDatetime\n              document {\n                data\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n",
        "variables": null
      }
    },
    "template.html": {
      "type": "TeraTemplate",
      "data": {
        "output": "Html",
        "template": "{% set_global timezone = \"Pacific/Port_Moresby\" %}\n\n<style type=\"text/css\">  \n  {% include \"style.css\" %}\n</style>\n\n<h1>CT GBV Register</h1>\n<h2>For</h2>\n<h2>{{data.store.storeName}}</h2>\n{% if data.store.logo %}\n<div class=\"store-logo-container\">\n<img class=\"logo\" id='store-logo' src='{{data.store.logo}}' />\n</div>\n{% endif %}\n\n<div class=\"container\">\n<table>\n  <thead>\n    <tr class=\"heading\">\n      <td>Visit Date</td>\n      <td>Patient ID</td>\n      <td>Sex</td>\n      <td>Date Of Birth</td>\n      <td>GBV Screened</td>\n      <td>GBV Type</td>\n      <td>GBV Referred</td>\n      <td>IPV Case</td>\n      <td>Rape Case</td>\n      <td>GBV Services Provided</td>\n      <td>GBV Service Type</td>\n    </tr>\n  </thead>\n  <tbody>\n  {% for patient in data.patients.nodes %}\n    {% if patient.programEnrolments | length > 0 %}\n      {% set enrolment = patient.programEnrolments.0 %}\n        {% if enrolment.encounters.nodes | length > 0 %}\n          {% set encounter = enrolment.encounters.nodes.0 %}\n          {% set gbv = encounter.document.data.genderBasedViolence %}\n          <tr>\n            <td>\n              {{encounter.startDatetime | date(format=\"%d/%m/%Y\",timezone=timezone)}}\n            </td>\n            <td>{{enrolment.programEnrolmentId}}</td>\n            <td>\n              {% if patient.gender == \"FEMALE\" %}\n                Female\n              {% elif patient.gender == \"MALE\" %}\n                Male\n              {% elif patient.gender == \"TRANSGENDER\" %}\n                Transgender\n              {% else %}\n                {{patient.gender}}\n              {% endif %}\n            </td>\n            <td>\n              {{patient.dateOfBirth | date(format=\"%d/%m/%Y\",timezone=timezone)}}\n            </td>\n            <td>\n              {% if gbv.screened %}\n                {{gbv.screened}}\n              {% endif %}\n            </td>\n            <td>\n              {% if gbv.type %}\n                {{gbv.type}}\n              {% endif %}\n            </td>\n            <td>\n              {% if gbv.referredForExternalServices %}\n                {{gbv.referredForExternalServices}}\n              {% endif %}\n            </td>\n            <td>\n              {% if gbv.intimatePartnerViolence %}\n                {{gbv.intimatePartnerViolence}}\n              {% endif %}\n            </td>\n            <td>\n              {% if gbv.rape %}\n                {{gbv.rape}}\n              {% endif %}\n            </td>             \n            <td>\n              {% if gbv.postServiceProvided %}\n                {{gbv.postServiceProvided}}\n              {% endif %}\n            </td>\n            <td>\n              {% if gbv.receivedServiceType %}\n                {{gbv.receivedServiceType}}\n              {% endif %}\n            </td>\n          </tr>\n        {% endif %}\n    {% endif %}\n  {% endfor %}\n  </tbody>\n</table>\n</div>    \n"
      }
    },
    "style.css": {
      "type": "Resource",
      "data": "@page {\n  margin: 0;\n  size: A4 landscape;\n}\n\n.paging {\n  width: 100%;\n}\n\nh1 {\n  width: fit-content;\n  margin: 7 auto;\n  padding: 0px 30px;\n  border: 1px solid black;\n  box-shadow: 5px 5px 0px black;\n  font-size: 15px;\n  margin-bottom: 10px;\n}\n\nh2 {\n  width: fit-content;\n  margin: 5 auto;\n  font-size: 15px;\n}\n\n.store-logo-container {\n  position: absolute;\n  top: 5;\n  right: 30;\n}\n\n.store-logo-container .logo {\n  display: block;\n  width: 70px;\n  height: 70px;\n}\n\n.container {\n  margin: auto;\n  padding: 10px;\n  border-top: 2px solid black;\n  font-size: 12px;\n  font-family: \"Helvetica Neue\", \"Helvetica\", Helvetica, Arial, sans-serif;\n  color: #555;\n}\n\n.container table {\n  width: 100%;\n  font-size: inherit;\n  font-family: inherit;\n  text-align: left;\n  margin-top: 10;\n  margin-bottom: 15;\n}\n\n.container table td {\n  padding: 5px;\n  vertical-align: top;\n}\n\n.container table tr.heading td {\n  font-weight: bold;\n  margin-bottom: 15px;\n}\n"
    }
  }
}
