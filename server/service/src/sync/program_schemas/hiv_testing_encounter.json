{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "ARTFacilityLocation": {
      "enum": ["THIS_FACILITY", "OTHER_FACILITY"],
      "type": "string"
    },
    "Clinician": {
      "properties": {
        "firstName": {
          "type": "string"
        },
        "id": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        }
      },
      "type": "object"
    },
    "EncounterStatus": {
      "enum": ["SCHEDULED", "COMPLETED", "CANCELLED"],
      "type": "string"
    },
    "FamilyPlanning": {
      "properties": {
        "contraception": {
          "$ref": "#/definitions/YesNo",
          "description": "13197004 Contraception"
        },
        "pregnant": {
          "description": "77386006 Pregnant",
          "enum": ["Yes", "No", "Breastfeeding"],
          "type": "string"
        }
      },
      "type": "object"
    },
    "GBVScreeningOutcome": {
      "enum": ["POSITIVE", "NEGATIVE", "NOT_DONE", "DECLINED"],
      "type": "string"
    },
    "HIVRiskGroup": {
      "enum": [
        "LRM",
        "MSM",
        "MSW",
        "MSMSW",
        "HRM",
        "LRW",
        "HRW",
        "FSW",
        "TG",
        "TGSW"
      ],
      "type": "string"
    },
    "HIVStatus": {
      "enum": ["POSITIVE", "NEGATIVE", "UNKNOWN"],
      "type": "string"
    },
    "HIVTestType": {
      "enum": ["PCR", "ANTIBODY"],
      "type": "string"
    },
    "HIVTestingEncounter": {
      "properties": {
        "clinician": {
          "$ref": "#/definitions/Clinician"
        },
        "createdDatetime": {
          "description": "Date time when the encounter was made, e.g. when an clinician schedule the encounter.",
          "format": "date-time",
          "type": "string"
        },
        "endDatetime": {
          "description": "Encounter end date and time",
          "format": "date-time",
          "type": "string"
        },
        "familyPlanning": {
          "$ref": "#/definitions/FamilyPlanning"
        },
        "hivTesting": {
          "properties": {
            "clientEscorted": {
              "description": "Was the client escorted?",
              "type": "boolean"
            },
            "condomDemonstration": {
              "description": "Did you conduct condom demonstration?",
              "type": "boolean"
            },
            "condomsLubricantsOffered": {
              "description": "6. Where condoms and/or lubricants offered to the client?",
              "type": "boolean"
            },
            "datetime": {
              "description": "Date of HIV Test done",
              "format": "date-time",
              "type": "string"
            },
            "numberOfFemaleCondoms": {
              "type": "number"
            },
            "numberOfLubricants": {
              "type": "number"
            },
            "numberOfMaleCondoms": {
              "description": "6a. If yes number of males condoms provided?",
              "type": "number"
            },
            "otherServiceName": {
              "description": "5aa. If other, specify:",
              "type": "string"
            },
            "otherServices": {
              "description": "5a. If yes, which one(s): TB, STI, GBV, PEP, Other",
              "items": {
                "$ref": "#/definitions/OtherServiceType"
              },
              "type": "array"
            },
            "postTestCounsellingDone": {
              "description": "Post-test counselling done?",
              "type": "boolean"
            },
            "referredARTFacility": {
              "$ref": "#/definitions/ARTFacilityLocation",
              "description": "2aa. Where ? This facility or Another Facility"
            },
            "referredARTFacilityName": {
              "description": "2aaa. If another facility, name of the facility",
              "type": "string"
            },
            "referredForARTServices": {
              "description": "2. Did you refer the patient for ART services?",
              "type": "boolean"
            },
            "result": {
              "$ref": "#/definitions/HIVStatus"
            },
            "screenedAndReferredForOtherServices": {
              "description": "5. Was client screened and referred for other services?",
              "type": "boolean"
            },
            "serodiscordantCoupleCounsellingProvided": {
              "$ref": "#/definitions/YesNoNA",
              "description": "If serodiscordant, was couple counselling provided?"
            },
            "type": {
              "$ref": "#/definitions/HIVTestType"
            }
          },
          "required": ["datetime", "type", "result"],
          "type": "object"
        },
        "htcRegisterSerialNumber": {
          "type": "string"
        },
        "informedConsent": {
          "properties": {
            "consentFormSigned": {
              "description": "Was the consent form signed?",
              "type": "boolean"
            },
            "preTestCounsellingDone": {
              "description": "Was pre-test counselling done?",
              "type": "boolean"
            }
          },
          "type": "object"
        },
        "notes": {
          "description": "An overall note for additional comments about the encounter",
          "items": {
            "$ref": "#/definitions/Note"
          },
          "type": "array"
        },
        "riskBehaviour": {
          "$ref": "#/definitions/RiskBehaviourTesting"
        },
        "startDatetime": {
          "description": "Encounter start date and time",
          "format": "date-time",
          "type": "string"
        },
        "status": {
          "$ref": "#/definitions/EncounterStatus"
        }
      },
      "required": ["createdDatetime", "startDatetime"],
      "type": "object"
    },
    "HIVTestingStatus": {
      "enum": ["POSITIVE", "NEGATIVE", "UNKNOWN", "NOT_DONE"],
      "type": "string"
    },
    "Note": {
      "properties": {
        "authorId": {
          "description": "authorId should be captured automatically from app state",
          "type": "string"
        },
        "authorName": {
          "description": "Practitioner's \"real\" name. Currently needs to be entered, but would ideally default to local state (but we don't yet have this in the database)",
          "type": "string"
        },
        "created": {
          "description": "Datetime when the note has been created",
          "format": "date-time",
          "type": "string"
        },
        "text": {
          "type": "string"
        }
      },
      "required": ["text", "created", "authorId", "authorName"],
      "type": "object"
    },
    "OtherServiceType": {
      "enum": ["TB", "STI", "GBV", "PEP", "OTHER"],
      "type": "string"
    },
    "RiskBehaviourTesting": {
      "properties": {
        "accidentalNeedlePick": {
          "description": "Have you received any of the following in the past 12 months ?: Accidental needle pick ?",
          "type": "boolean"
        },
        "forcedSexWithoutConsent": {
          "description": "Have you received any of the following in the past 12 months ?: Forced to have sex without consent ?",
          "type": "boolean"
        },
        "injectedDrugsWithoutDoctorAdvice": {
          "description": "Have you received any of the following in the past 12 months ?: Injected drugs without doctor's advice ?",
          "type": "boolean"
        },
        "numberFemaleSexualPartners6Month": {
          "description": "How many female sexual partners have you had in the last 6 months ?",
          "type": "number"
        },
        "numberMaleSexualPartners6Month": {
          "description": "How many male sexual partners have you had in the last 6 months ?",
          "type": "number"
        },
        "previousHIVTestDate": {
          "description": "Date of a previous HIV test",
          "format": "date",
          "type": "string"
        },
        "previousHIVTestResult": {
          "$ref": "#/definitions/HIVTestingStatus"
        },
        "prostitution": {
          "description": "Have you received any of the following in the past 12 months ?: Sex in exchange for money/goods/services ?",
          "type": "boolean"
        },
        "receivedBloodTransfusion": {
          "description": "Have you received any of the following in the past 12 months ?: Received a blood transfusion ?",
          "type": "boolean"
        },
        "referredToGBVService": {
          "description": "If GBV screening = positive, referred for GBV services ? Yes or No",
          "type": "boolean"
        },
        "riskGroup": {
          "$ref": "#/definitions/HIVRiskGroup"
        },
        "screeningOutcomeGBV": {
          "$ref": "#/definitions/GBVScreeningOutcome"
        },
        "sexWithSameSex": {
          "description": "Have you received any of the following in the past 12 months ?: Had sex with someone of the same sex ?",
          "type": "boolean"
        },
        "sexualTransmittedInfection": {
          "description": "Have you received any of the following in the past 12 months ?: Sexually transmitted infection (STI)",
          "type": "boolean"
        },
        "unprotectedAnalSex": {
          "description": "Have you received any of the following in the past 12 months ?: Unprotected anal sex ?",
          "type": "boolean"
        },
        "unprotectedVaginalSex": {
          "description": "Have you received any of the following in the past 12 months ?: Unprotected vaginal sex ?",
          "type": "boolean"
        }
      },
      "type": "object"
    },
    "YesNo": {
      "enum": ["Yes", "No"],
      "type": "string"
    },
    "YesNoNA": {
      "enum": ["Yes", "No", "N/A"],
      "type": "string"
    }
  },
  "type": "object",
  "allOf": [
    {
      "$ref": "#/definitions/HIVTestingEncounter"
    }
  ]
}
