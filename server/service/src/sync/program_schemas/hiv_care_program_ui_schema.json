{
  "type": "VerticalLayout",
  "elements": [
    {
      "type": "Header",
      "options": {
        "header": "Enrolment Form",
        "subheader": "HIV Care and Treatment"
      }
    },
    {
      "type": "Control",
      "scope": "#/properties/enrolmentDatetime",
      "label": "Enrolment Date",
      "options": {
        "dateOnly": true
      }
    },
    {
      "type": "IdGenerator",
      "label": "Patient Program Id",
      "scope": "#/properties/programEnrolmentId",
      "options": {
        "parts": [
          {
            "type": "StoreName",
            "mutations": [{ "firstNChars": 3 }, { "toUpperCase": true }]
          },
          {
            "type": "Number",
            "numberName": "HIVProgram",
            "mutations": [{ "padString": "0000" }]
          }
        ],
        "allowManualEntry": true,
        "validations": [
          {
            "type": "UniqueEnrolmentId"
          }
        ]
      }
    },
    {
      "type": "Control",
      "scope": "#/properties/status",
      "label": "Status:",
      "options": {
        "show": [
          ["ACTIVE", "Active"],
          ["OPTED_OUT", "Opted out"],
          ["TRANSFERRED_OUT", "Transferred out"],
          ["PAUSED", "Paused"]
        ]
      }
    },
    {
      "type": "Control",
      "scope": "#/properties/hivConfirmationDate",
      "label": "HIV Confirmation Date"
    },
    {
      "type": "Control",
      "scope": "#/properties/hivTestType",
      "label": "HIV Test Type:"
    },
    {
      "type": "Control",
      "label": "Risk Group",
      "scope": "#/properties/riskGroup"
    },
    {
      "type": "Control",
      "scope": "#/properties/partnerHIVStatus",
      "label": "Partner HIV Status:",
      "options": {
        "show": [
          ["POSITIVE", "Positive"],
          ["NEGATIVE", "Negative"],
          ["UNKNOWN", "Unknown"],
          ["NOT_DONE", "Not Done"]
        ]
      }
    },
    {
      "type": "Search",
      "scope": "#/properties/mother",
      "options": {
        "source": "user",
        "query": "patientByCode",
        "saveFields": [
          "id",
          "code",
          "firstName",
          "lastName",
          "dateOfBirth",
          "gender"
        ]
      }
    },
    {
      "type": "Group",
      "label": "Treatment Supporter",
      "elements": [
        {
          "type": "Control",
          "scope": "#/properties/treatmentSupporterIsNextOfKin",
          "label": "Is the Treatment Supporter the patient's next of kin?"
        },
        {
          "type": "Control",
          "scope": "#/properties/treatmentSupporter/properties/firstName"
        },
        {
          "type": "Control",
          "scope": "#/properties/treatmentSupporter/properties/lastName"
        },
        {
          "type": "FirstItemArray",
          "scope": "#/properties/treatmentSupporter/properties/contactDetails",
          "options": {
            "detail": {
              "type": "VerticalLayout",
              "elements": [
                {
                  "type": "Control",
                  "scope": "/properties/phone"
                },
                {
                  "type": "Control",
                  "scope": "/properties/mobile"
                },
                {
                  "type": "Control",
                  "scope": "/properties/email"
                }
              ]
            }
          }
        }
      ],
      "rule": {
        "effect": "HIDE",
        "condition": {
          "scope": "#/properties/treatmentSupporterIsNextOfKin",
          "schema": { "const": true }
        }
      }
    },
    {
      "type": "Group",
      "label": "Treatment Supporter",
      "elements": [
        {
          "type": "Control",
          "scope": "#/properties/treatmentSupporterIsNextOfKin",
          "label": "Is the Treatment Supporter the patient's next of kin?"
        },
        {
          "type": "Search",
          "scope": "#/properties/treatmentSupporter",
          "options": {
            "source": "document",
            "document": "patient",
            "path": "document.data.family.nextOfKin",
            "displayString": "${firstName} ${lastName} (${relationship})\nPhone: ${contactDetails[0].phone}"
          }
        }
      ],
      "rule": {
        "effect": "SHOW",
        "condition": {
          "scope": "#/properties/treatmentSupporterIsNextOfKin",
          "schema": {
            "const": true
          }
        }
      }
    },
    {
      "type": "Group",
      "label": "Referral or Transfer in Details",
      "elements": [
        {
          "type": "Control",
          "scope": "#/properties/referredFrom",
          "label": "Referred from:",
          "options": {
            "show": [
              ["HCT_OTHER_PICT", "HCT other PICT"],
              ["INDEX", "Index"],
              ["LABOUR", "Labour"],
              ["POST_NATAL", "Post Natal"],
              ["TB", "TB"],
              ["COMMUNITY", "Community"],
              ["TRANSFER_IN", "Transfer in"],
              ["STI", "STI"],
              ["ANC", "ANC"],
              [
                "EXPOSED_INFANT_WELL_BABY_CLINIC",
                "Exposed infant well baby clinic"
              ],
              ["IN_PATIENT", "In patient"]
            ]
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/priorART",
          "label": "Prior ART:",
          "options": {
            "show": [
              ["TRANSFER_IN_WITH_RECORDS", "Transfer in with records"],
              ["TRANSFER_IN_WITHOUT_RECORDS", "Transfer in without records"],
              ["PPTCT_PROPHYLAXIS", "PPTCT Prophylaxis"],
              ["PEP", "PEP"],
              ["PrEP", "PrEP"]
            ]
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/clinicTransferredFrom"
        },
        {
          "type": "Control",
          "scope": "#/properties/previousClinicARTStartDate"
        },
        {
          "type": "Control",
          "scope": "#/properties/dateTransferredIn"
        },
        {
          "type": "Control",
          "scope": "#/properties/previousClinicId"
        }
      ]
    }
  ]
}
