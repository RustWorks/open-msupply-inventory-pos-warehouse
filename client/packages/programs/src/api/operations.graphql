fragment Document on DocumentNode {
  id
  name
  parents
  author
  timestamp
  type
  data
  documentRegistry {
    uiSchemaType
    documentType
    context
    formSchemaId
    jsonSchema
    uiSchema
  }
}

query documentByName($name: String!, $storeId: String!) {
  document(name: $name, storeId: $storeId) {
    __typename
    ... on DocumentNode {
      ...Document
    }
  }
}

query documents(
  $storeId: String!
  $page: PaginationInput
  $filter: DocumentFilterInput
  $sort: DocumentSortInput
) {
  documents(storeId: $storeId, page: $page, filter: $filter, sort: $sort) {
    __typename
    ... on DocumentConnector {
      nodes {
        ...Document
      }
    }
  }
}

fragment DocumentRegistry on DocumentRegistryNode {
  __typename
  id
  documentType
  context
  name
  parentId
  formSchemaId
  jsonSchema
  uiSchemaType
  uiSchema
}

query documentRegistries(
  $filter: DocumentRegistryFilterInput
  $sort: DocumentRegistrySortInput
) {
  documentRegistries(filter: $filter, sort: $sort) {
    ... on DocumentRegistryConnector {
      __typename
      nodes {
        __typename
        context
        documentType
        formSchemaId
        id
        jsonSchema
        name
        parentId
        uiSchema
        uiSchemaType
      }
      totalCount
    }
  }
}

mutation allocateProgramNumber($numberName: String!, $storeId: String!) {
  allocateProgramNumber(input: { numberName: $numberName }, storeId: $storeId) {
    ... on NumberNode {
      __typename
      number
    }
  }
}

fragment EncounterFields on EncounterFieldsNode {
  fields
  encounter {
    name
    startDatetime
    endDatetime
  }
}

query encounterFields(
  $storeId: String!
  $patientId: String!
  $fields: [String!]
) {
  encounterFields(
    input: { fields: $fields }
    storeId: $storeId
    sort: { key: startDatetime }
    filter: { patientId: { equalTo: $patientId } }
  ) {
    ... on EncounterFieldsConnector {
      __typename
      nodes {
        __typename
        ...EncounterFields
      }
    }
  }
}

fragment EncounterDocumentRegistry on DocumentRegistryNode {
  context
  documentType
  formSchemaId
  id
  jsonSchema
  name
  parentId
  uiSchema
  uiSchemaType
  children {
    id
  }
}

fragment EncounterBase on EncounterNode {
  id
  type
  name
  status
  patient {
    id
    firstName
    lastName
    name
  }
  program
  startDatetime
  endDatetime
  document {
    ...Document
  }
}

query encounterById($storeId: String!, $encounterId: String!) {
  encounters(storeId: $storeId, filter: { id: { equalTo: $encounterId } }) {
    ... on EncounterConnector {
      __typename
      nodes {
        ...EncounterBase
      }
      totalCount
    }
  }
}

query encounters(
  $storeId: String!
  $key: EncounterSortFieldInput
  $desc: Boolean
  $filter: EncounterFilterInput
  $page: PaginationInput
) {
  encounters(
    storeId: $storeId
    sort: { key: $key, desc: $desc }
    filter: $filter
    page: $page
  ) {
    ... on EncounterConnector {
      __typename
      nodes {
        ...EncounterBase
      }
      totalCount
    }
  }
}
