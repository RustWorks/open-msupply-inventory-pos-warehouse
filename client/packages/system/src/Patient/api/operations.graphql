fragment PatientRow on PatientNode {
  id
  code
  code2
  firstName
  lastName
  name
  dateOfBirth
  gender
  email
  document {
    id
    name
    type
  }
  isDeceased
}

fragment ProgramEvent on ProgramEventNode {
  activeDatetime
  type
  data
}

fragment ProgramEnrolmentRow on ProgramEnrolmentNode {
  enrolmentDatetime
  name
  patientId
  programPatientId
  type
  document {
    documentRegistry {
      id
      name
    }
  }
  events(at: $eventTime) {
    ...ProgramEvent
  }
}

fragment Patient on PatientNode {
  address1
  address2
  code
  code2
  country
  dateOfBirth
  document {
    id
    name
    type
  }
  email
  firstName
  lastName
  gender
  id
  name
  phone
  website
  isDeceased
}

query patients(
  $storeId: String!
  $key: PatientSortFieldInput!
  $desc: Boolean
  $first: Int
  $offset: Int
  $filter: PatientFilterInput
) {
  patients(
    storeId: $storeId
    page: { first: $first, offset: $offset }
    sort: { key: $key, desc: $desc }
    filter: $filter
  ) {
    ... on PatientConnector {
      __typename
      nodes {
        ...PatientRow
      }
      totalCount
    }
  }
}

query patientById($storeId: String!, $nameId: String!) {
  patients(storeId: $storeId, filter: { id: { equalTo: $nameId } }) {
    ... on PatientConnector {
      __typename
      nodes {
        ...Patient
      }
      totalCount
    }
  }
}

query patientSearch($input: PatientSearchInput!, $storeId: String!) {
  patientSearch(input: $input, storeId: $storeId) {
    ... on PatientSearchConnector {
      __typename
      nodes {
        score
        patient {
          ...Patient
        }
      }
      totalCount
    }
  }
}

query getDocumentHistory($storeId: String!, $name: String!) {
  documentHistory(storeId: $storeId, name: $name) {
    __typename
    ... on DocumentConnector {
      totalCount
      nodes {
        __typename
        author
        data
        id
        name
        parents
        timestamp
        type
      }
    }
  }
}

query programEnrolments(
  $storeId: String!
  $key: ProgramEnrolmentSortFieldInput!
  $desc: Boolean
  $filter: ProgramEnrolmentFilterInput
  $eventTime: String!
) {
  programEnrolments(
    storeId: $storeId
    sort: { key: $key, desc: $desc }
    filter: $filter
  ) {
    ... on ProgramEnrolmentConnector {
      __typename
      nodes {
        ...ProgramEnrolmentRow
      }
      totalCount
    }
  }
}

mutation insertPatient($storeId: String!, $input: InsertPatientInput!) {
  insertPatient(storeId: $storeId, input: $input) {
    ... on PatientNode {
      __typename
      ...PatientRow
    }
  }
}

mutation updatePatient($storeId: String!, $input: UpdatePatientInput!) {
  updatePatient(storeId: $storeId, input: $input) {
    ... on PatientNode {
      __typename
      ...PatientRow
    }
  }
}

fragment PatientEncounterRow on EncounterNode {
  id
  document {
    documentRegistry {
      name
    }
  }
  program
  startDatetime
  endDatetime
  status
  name
  type
  patient {
    id
    firstName
    lastName
    name
  }
  events(at: $eventTime) {
    ...ProgramEvent
  }
}

query encounters(
  $storeId: String!
  $key: EncounterSortFieldInput!
  $desc: Boolean
  $filter: EncounterFilterInput
  $page: PaginationInput
  $eventTime: String!
) {
  encounters(
    storeId: $storeId
    sort: { key: $key, desc: $desc }
    filter: $filter
    page: $page
  ) {
    ... on EncounterConnector {
      nodes {
        ...PatientEncounterRow
      }
      totalCount
    }
  }
}
